# VeeamTestTask-FolderSync

## Table of Contents
- [Overview](#overview)
- [Features](#features)
- [How to Run](#how-to-run)
- [Where It Can Be Used](#where-it-can-be-used)
- [Build and Run Example](#build-and-run-example)
- [Examples](#examples)
- [Log Message Examples](#log-message-examples)


## Overview
This is a simple folder synchronization console app.
It keeps a replica folder in sync with a source folder at a specified interval, logging all operations.

## Features
- **Efficient Caching of File Updates:**
	- Only changed or new files are copied, using a snapshot of file states to avoid unnecessary operations.
- **Replica Integrity Checking:**
	- The replica folder is continuously checked. If any file or folder disappears from the replica but still exists in the source, it will be automatically restored (copied again) from the source.
- **State Persistence in JSON:**
	- The app stores a snapshot of the last sync state in a JSON file inside the replica folder. This allows the app to resume from where it left off after a restart, ensuring no redundant copying or data loss.
- **Safe Restart:**
	- You can stop and restart the app at any time. It will pick up changes since the last run using the persisted snapshot.
- **Optimized Synchronization:**
	- Uses in-memory and on-disk snapshots to minimize disk I/O and speed up sync cycles.
- **Robust File Update Logic:**
	- Detects new, changed, and deleted files and folders, ensuring the replica is always an accurate mirror of the source.
- **Logging:**
	- All operations and errors are logged to a file for easy troubleshooting and auditing.
- **Error Handling and Retries:**
	- File copy operations are retried on failure to handle transient errors.


## How to Run
1. Build the solution using Visual Studio or `dotnet build`.
2. Run the application from the command line:

```
dotnet run --project FolderSync.App -- -s "<SourceFolder>" -r "<ReplicaFolder>" -i <IntervalMs> -l "<LogFilePath>"
```

Or, if you have a compiled executable (e.g., `FolderSync.exe`):

```
FolderSync.exe -s "C:\Source" -r "C:\Replica" -i 2000 -l "C:\Logs\sync.log"
```

### Arguments
- `-s`, `--source`   : Path to the source folder (required)
- `-r`, `--replica`  : Path to the replica folder (required)
- `-i`, `--interval` : Synchronization interval in milliseconds (required)
- `-l`, `--log`      : Path to the log file (required)

## Where It Can Be Used
- Keeping a backup folder in sync with a main folder (even remote, virtual machine, server)

## Build and Run Example

```
dotnet run --project FolderSync.App -- -s "C:\Data\Source" -r "C:\Data\Replica" -i 5000 -l "C:\Logs\sync.log"
```


This will synchronize `C:\Data\Source` to `C:\Data\Replica` every 5 seconds, logging to `C:\Logs\sync.log`.


## Examples

### Screenshots

**Before Sync:**
![Before Sync](Examples/BeforeSync.png)

**After Sync:**
![After Sync](Examples/AfterSync.png)

**Changed Folder Name:**
![Changed Folder Name](Examples/ChangedFolderName.png)

**Created Some File:**
![Created Some File](Examples/CreatedSomeFile.png)

**Deleted Folder:**
![Deleted Folder](Examples/DeletedFolder.png)

**Screenshot (UI Example):**
![Screenshot](Examples/Screenshot%202025-08-20%20213139.png)



### Log Message Examples

Below are examples of log messages generated by the application:

**INFO**
```
2025-08-20 21:30:23,786 [1] INFO  FolderSync.Core.FolderSynchronizer - FolderSynchronizer initialized. Source='C:\Data\Source', Replica='C:\Data\Replica', StateFile='C:\Data\Replica\.foldersync.XXXX.snapshot.json'
2025-08-20 21:30:58,868 [1] INFO  FolderSync.Core.FolderSynchronizer - Copied NEW file 'C:\Data\Source\ConsoleArguments.cs' -> 'C:\Data\Replica\ConsoleArguments.cs'.
2025-08-20 21:30:58,869 [1] INFO  FolderSync.Core.FolderSynchronizer - Updated file 'C:\Data\Source\Program.cs' -> 'C:\Data\Replica\Program.cs'.
2025-08-20 21:30:23,796 [1] INFO  FolderSync.Core.FolderSynchronizer - Synchronization cycle completed (no changes).
2025-08-20 21:33:05,306 [1] INFO  FolderSync.Core.ReplicaMaintenance - Deleted extraneous file 'C:\Data\Replica\bin\Debug\net8.0\Microsoft.TestPlatform.CrossPlatEngine.dll'.
```

**WARN**
```
2025-08-20 21:31:00,123 [1] WARN  FolderSync.Core.FolderSynchronizer - Sync attempt skipped; previous sync still running.
2025-08-20 21:31:01,456 [1] WARN  FolderSync.Core.FolderSynchronizer - Skipped copy (source vanished mid-operation): 'C:\Data\Source\SomeFile.txt'.
2025-08-20 21:31:02,789 [1] WARN  FolderSync.Core.FolderSynchronizer - Snapshot state file present but empty or malformed; starting fresh.
2025-08-20 21:31:03,012 [1] WARN  FolderSync.Core.FolderSynchronizer - Failed to load previous snapshot state: Unexpected token. Starting fresh.
2025-08-20 21:31:04,345 [1] WARN  FolderSync.Core.FolderSynchronizer - Failed to persist snapshot state: Access denied.
```

**ERROR**
```
2025-08-20 21:32:00,567 [1] ERROR FolderSync.Core.FolderSynchronizer - Exception during logging configuration: System.IO.FileNotFoundException: log4net.config not found
2025-08-20 21:32:01,890 [1] ERROR FolderSync.Core.FolderSynchronizer - Unexpected error during synchronization cycle: System.IO.IOException: Disk full
2025-08-20 21:32:02,234 [1] ERROR FolderSync.Core.FolderSynchronizer - Failed copying 'C:\Data\Source\File.txt' -> 'C:\Data\Replica\File.txt': Access denied.
```

**DEBUG**
```
2025-08-20 21:33:00,111 [1] DEBUG FolderSync.Core.FolderSynchronizer - No changes detected; snapshot persistence skipped.
2025-08-20 21:33:01,222 [1] DEBUG FolderSync.Core.ReplicaMaintenance - Removed empty directory 'C:\Data\Replica\Temp'.
2025-08-20 21:33:02,333 [1] DEBUG FolderSync.Core.FolderSynchronizer - No previous snapshot state file found; starting fresh.
```

You can find a full sample log file in [Examples/logging.log](Examples/logging.log).

